{
  "name": "love consultant",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "line-bot",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -384,
        240
      ],
      "id": "0153c7a4-452e-4a28-9e3b-21f1fe127696",
      "name": "Webhook",
      "webhookId": "8c7089e1-1539-4eb0-9f5f-805107f18e9d"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0d865dbd-e698-441a-9925-4bbcf13f9774",
              "name": "chat_text",
              "value": "={{ $json.chat_text }}",
              "type": "string"
            },
            {
              "id": "07273d63-ea79-4dd7-9fa4-dba4fc039aa5",
              "name": "replyToken",
              "value": "={{ $json.replyToken }}",
              "type": "string"
            },
            {
              "id": "a473564d-4583-4ca2-8bb6-26a37d3cd2e3",
              "name": "userId",
              "value": "={{ $json.userId }}",
              "type": "string"
            },
            {
              "id": "fb0a81cc-db34-4bd0-ab5c-b609d8860479",
              "name": "route",
              "value": "={{ $json.route }}",
              "type": "string"
            },
            {
              "id": "adddd9b4-5e70-4bfa-9d1c-b28527b0094d",
              "name": "route_expand",
              "value": "={{ $json.route_expanded }}",
              "type": "string"
            },
            {
              "id": "39965148-0152-4d10-87fb-943a8dce0c08",
              "name": "buddy",
              "value": "={{ $json.buddy }}",
              "type": "boolean"
            },
            {
              "id": "36dbd4ba-8c1a-408c-ae1c-50eebf4c2908",
              "name": "closing",
              "value": "={{ $json.closing }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1520,
        176
      ],
      "id": "bb6a937e-ff9b-4f23-babe-275628da09ee",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1856,
        880
      ],
      "id": "73fd9041-bab3-41a4-91d3-b553cc476c29",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "tIHUPdMbXkkTH0y7",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $('Edit Fields').item.json.replyToken }}\",\n\"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.output.replaceAll('\\n','\\\\n').replaceAll('\"','')}}\"\n    }\n  ]\n}\n\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2688,
        -208
      ],
      "id": "b3d06c71-7d3a-443c-8b9a-65c132d29cee",
      "name": "HTTP Request",
      "credentials": {
        "httpBearerAuth": {
          "id": "wAbVyNGfMeeH6MYu",
          "name": "Bearer Line Auth account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.userId }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1968,
        880
      ],
      "id": "9fb8a6a4-f59c-4244-8378-819d23345084",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "jsCode": "const ROUTE_MAP = {\n  conflict: \"‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ú‡∏¥‡∏î\",\n  family: \"‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡πà‡∏≠‡∏ï‡∏≤ ‡πÅ‡∏°‡πà‡∏¢‡∏≤‡∏¢ ‡∏û‡πà‡∏≠‡∏ú‡∏±‡∏ß ‡πÅ‡∏°‡πà‡∏ú‡∏±‡∏ß ‡∏ç‡∏≤‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏∑‡πâ‡∏°\",\n  dateidea: \"‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏ó ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î\",\n  deeptalk: \"‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° deep talk ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏®\",\n  moveon: \"‡∏Å‡∏≤‡∏£ move on ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏±‡∏ô\",\n  sex: \"‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏®‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏™‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢\",\n  romance: \"‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏£‡πÅ‡∏°‡∏ô‡∏ï‡∏¥‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\",\n  marriage: \"‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô\",\n  breakup: \"‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î\",\n  trust: \"‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\",\n  debt: \"‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\",\n  time: \"‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏π‡πà‡∏£‡∏±‡∏Å\",\n  default: \"‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\"\n};\n\nconst routes = $json.route || [];\nconst expanded = (Array.isArray(routes) ? routes : [routes])\n  .map(r => ROUTE_MAP[r] || r)\n  .join(\", \");\n\nreturn [{ json: { ...$json, route_expanded: expanded } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        240
      ],
      "id": "6fa21209-c658-497d-b83a-881a82cfd1c1",
      "name": "‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠"
    },
    {
      "parameters": {
        "jsCode": "// ============ Helpers ============\nconst rmThaiMarks = (s) =>\n  String(s || '')\n    .normalize('NFKD')\n    .replace(/[\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E]/g, '')\n    .replace(/\\u200B/g, '');\n\nconst normalize = (s) => {\n  const raw = String(s || '').trim();\n  const lower = raw.toLowerCase();\n  const noMarks = rmThaiMarks(lower);\n  const noSpace = noMarks.replace(/\\s+/g, '');\n  return { raw: lower, noMarks, noSpace };\n};\n\nconst esc = (s) => s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\n// ============ Categories ============\nconst CATEGORIES = {\n  conflict:  ['‡∏ó‡∏∞‡πÄ‡∏•‡∏≤‡∏∞','‡∏á‡∏≠‡∏ô','‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÉ‡∏™‡πà','‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡∏¢','‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏¥‡∏ô','‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤','‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á'],\n  family:    ['‡∏û‡πà‡∏≠‡∏ï‡∏≤','‡πÅ‡∏°‡πà‡∏¢‡∏≤‡∏¢','‡∏û‡πà‡∏≠‡∏ú‡∏±‡∏ß','‡πÅ‡∏°‡πà‡∏ú‡∏±‡∏ß','‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß','‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢','‡πÅ‡∏°‡πà‡πÅ‡∏ü‡∏ô','‡∏û‡πà‡∏≠‡πÅ‡∏ü‡∏ô','‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà‡πÅ‡∏ü‡∏ô','‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏ü‡∏ô','‡∏ç‡∏≤‡∏ï‡∏¥‡πÅ‡∏ü‡∏ô'],\n  dateidea:  ['‡∏ä‡∏ß‡∏ô‡πÑ‡∏õ‡πÄ‡∏î‡∏ó','‡∏û‡∏≤‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß','‡∏û‡∏≤‡πÑ‡∏õ‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß','‡∏û‡∏≤‡πÑ‡∏õ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á','‡πÑ‡∏õ‡πÄ‡∏î‡∏ó‡∏Å‡∏±‡∏ô','‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ô','‡πÄ‡∏î‡∏ó','‡∏ô‡∏±‡∏î‡πÄ‡∏î‡∏ó','‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏ó','‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®','‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏π‡πà'],\n  deeptalk:  ['‡∏Ñ‡∏∏‡∏¢‡∏•‡∏∂‡∏Å‡∏ã‡∏∂‡πâ‡∏á','‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏•‡∏∂‡∏Å‡∏ã‡∏∂‡πâ‡∏á','‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à','‡πÅ‡∏ä‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏†‡∏≤‡∏¢‡πÉ‡∏ô','‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß','‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß','‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏•‡∏∂‡∏Å','‡∏Ñ‡∏∏‡∏¢‡πÉ‡∏´‡πâ‡∏•‡∏∂‡∏Å','deep talk','‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ'],\n  moveon:    ['‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á','‡∏•‡∏∑‡∏°‡∏≠‡∏î‡∏µ‡∏ï','‡∏•‡∏∑‡∏°‡πÅ‡∏ü‡∏ô‡πÄ‡∏Å‡πà‡∏≤','‡∏•‡∏∑‡∏°‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏≤','‡∏Å‡πâ‡∏≤‡∏ß‡∏ï‡πà‡∏≠‡πÑ‡∏õ','‡∏Å‡πâ‡∏≤‡∏ß‡∏Ç‡πâ‡∏≤‡∏°','move on','‡∏•‡∏∑‡∏°‡πÄ‡∏Ç‡∏≤‡πÑ‡∏î‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á','‡∏•‡∏∑‡∏°‡πÄ‡∏ò‡∏≠‡πÑ‡∏î‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á'],\n\n\n  \n  sex: [\n  // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ\n  '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á','‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏Å‡∏™‡πå','‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏®‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå','‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏ásex',\n  '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏Ñ‡∏π‡πà‡∏£‡∏±‡∏Å','‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏ö‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á','‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏®','sex',\n\n  // ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢\n  '‡∏ô‡∏Å‡πÄ‡∏Ç‡∏≤‡πÑ‡∏°‡πà‡∏Ç‡∏±‡∏ô','‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πá‡∏á','‡πÅ‡∏Ç‡πá‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà','‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏†‡∏≤‡∏û',\n  '‡∏´‡∏•‡∏±‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß','‡∏´‡∏•‡∏±‡πà‡∏á‡∏ä‡πâ‡∏≤','‡πÄ‡∏™‡∏£‡πá‡∏à‡πÑ‡∏ß','‡πÅ‡∏ï‡∏Å‡πÑ‡∏ß','‡∏ä‡∏±‡∏Å‡∏ä‡πâ‡∏≤','‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô',\n  '‡∏ô‡πâ‡∏≥‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å','‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à','‡∏°‡∏µ‡∏ô‡πâ‡∏≥‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à','‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå','‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏¢‡∏≤‡∏Å','‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î',\n  '‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å','‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà',\n\n  // ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á / ‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô\n  '‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏≤','‡πÄ‡∏°‡∏ô‡∏™‡πå‡πÑ‡∏°‡πà‡∏°‡∏≤','‡πÄ‡∏°‡∏ô‡∏™‡πå‡πÄ‡∏•‡∏ó','‡πÄ‡∏°‡∏ô‡∏™‡πå‡∏Ç‡∏≤‡∏î','‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á',\n  '‡∏õ‡∏ß‡∏î‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏°‡∏ô‡∏™‡πå','‡∏ï‡∏Å‡∏Ç‡∏≤‡∏ß','‡∏ï‡∏Å‡∏Ç‡∏≤‡∏ß‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥','‡∏Ñ‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡∏•‡∏≠‡∏î','‡∏Å‡∏•‡∏¥‡πà‡∏ô',\n  '‡πÄ‡∏à‡πá‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡∏•‡∏≠‡∏î','‡πÅ‡∏´‡πâ‡∏á','‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡πâ‡∏≥‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô',\n\n  // ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î / ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡πâ‡∏≠‡∏á\n  '‡πÄ‡∏à‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤xxx','‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡πâ‡∏≠‡∏á','‡∏ó‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤','‡∏à‡∏∞‡∏ó‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°','‡∏ß‡∏±‡∏ô‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢','‡∏ô‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÑ‡∏Ç‡πà‡∏ï‡∏Å',\n  '‡∏¢‡∏≤‡∏Ñ‡∏∏‡∏°','‡∏¢‡∏≤‡∏Ñ‡∏∏‡∏°‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô','‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î','‡∏ñ‡∏∏‡∏á‡∏¢‡∏≤‡∏á','‡∏û‡∏Å‡∏ñ‡∏∏‡∏á','‡∏™‡∏î','‡πÑ‡∏°‡πà‡∏™‡∏î',\n\n  // ‡πÇ‡∏£‡∏Ñ‡πÄ‡∏û‡∏®‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\n  '‡∏Å‡∏≤‡∏°‡πÇ‡∏£‡∏Ñ','‡πÇ‡∏£‡∏Ñ‡πÄ‡∏û‡∏®‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå','‡πÄ‡∏≠‡∏î‡∏™‡πå','HIV','‡∏ã‡∏¥‡∏ü‡∏¥‡∏•‡∏¥‡∏™','‡∏´‡∏ô‡∏≠‡∏á‡πÉ‡∏ô','‡∏´‡∏π‡∏î‡∏´‡∏á‡∏≠‡∏ô‡πÑ‡∏Å‡πà','‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠',\n\n  // ‡∏Ñ‡∏≥‡∏™‡πÅ‡∏•‡∏á/‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô\n  '‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£','‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡∏±‡∏ô','‡∏°‡∏µ‡πÄ‡∏ã‡πá‡∏Å‡∏™‡πå','‡∏ã‡∏±‡πà‡∏°','‡πÄ‡∏≠‡∏≤‡∏Å‡∏±‡∏ô','xxx','‡πÄ‡∏¢‡πá‡∏î',\n  '‡πÄ‡∏™‡∏µ‡∏¢‡∏ï‡∏±‡∏ß','‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏¥‡∏á','‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏à‡∏¥‡πâ‡∏ô','‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á','‡∏ô‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô',\n  '‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ú‡∏≤','‡∏Ç‡∏≠‡∏á‡∏•‡∏±‡∏ö','‡∏ü‡∏µ‡πÇ‡∏£‡πÇ‡∏°‡∏ô','‡πÄ‡∏á‡∏µ‡πà‡∏¢‡∏ô'\n],\n\n  \n  romance:   ['‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô','‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏£‡πÅ‡∏°‡∏ô‡∏ï‡∏¥‡∏Å','‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏Å‡∏´‡∏ß‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô','‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏Å‡πÇ‡∏£‡πÅ‡∏°‡∏ô‡∏ï‡∏¥‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô','‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡πÅ‡∏ü‡∏ô','‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏Ñ‡∏ô‡∏£‡∏±‡∏Å','‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÅ‡∏ü‡∏ô','‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏Ñ‡∏ô‡∏£‡∏±‡∏Å'],\n  marriage:  ['‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô','‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô','‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô','‡∏û‡∏¥‡∏ò‡∏µ‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô','‡∏û‡∏¥‡∏ò‡∏µ‡∏ß‡∏¥‡∏ß‡∏≤‡∏´‡πå','‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô','‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô'],\n  breakup:   ['‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏±‡∏ô','‡∏´‡∏¢‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏á','‡πÅ‡∏¢‡∏Å‡∏ó‡∏≤‡∏á‡∏Å‡∏±‡∏ô','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏à‡∏ö‡∏•‡∏á','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î','‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏ö‡∏Å‡∏±‡∏ô','‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏ü‡∏ô'],\n  trust:     ['‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à','‡∏Å‡∏≤‡∏£‡πÑ‡∏ß‡πâ‡πÉ‡∏à','‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à‡∏Å‡∏±‡∏ô','‡πÑ‡∏ß‡πâ‡πÉ‡∏à‡∏Å‡∏±‡∏ô','‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à','‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏à'],\n  debt:      [\n    '‡∏´‡∏ô‡∏µ‡πâ','‡∏ï‡∏¥‡∏î‡∏´‡∏ô‡∏µ‡πâ','‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏µ‡πâ','‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô','‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ','‡∏ó‡∏ß‡∏á‡∏´‡∏ô‡∏µ‡πâ','‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡∏µ‡πâ','‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô','‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô','‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô','‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß',\n    '‡∏´‡∏ô‡∏µ‡πâ‡∏û‡∏ô‡∏±‡∏ô','‡∏´‡∏ô‡∏µ‡πâ‡∏ö‡∏≠‡∏•','‡∏´‡∏ô‡∏µ‡πâ‡∏ö‡∏≤‡∏Ñ‡∏≤‡∏£‡πà‡∏≤','‡∏´‡∏ô‡∏µ‡πâ‡∏û‡∏ô‡∏±‡∏ô‡∏ö‡∏≠‡∏•',\n    '‡∏ï‡∏¥‡∏î‡∏û‡∏ô‡∏±‡∏ô','‡∏ï‡∏¥‡∏î‡∏û‡∏ô‡∏±‡∏ô‡∏ö‡∏≠‡∏•','‡∏ï‡∏¥‡∏î‡∏ö‡∏≤‡∏Ñ‡∏≤‡∏£‡πà‡∏≤','‡πÄ‡∏™‡∏µ‡∏¢‡∏û‡∏ô‡∏±‡∏ô','‡πÄ‡∏™‡∏µ‡∏¢‡∏ö‡∏≠‡∏•',\n    '‡πÇ‡∏ï‡πä‡∏∞‡∏ö‡∏≠‡∏•','‡πÅ‡∏ó‡∏á‡∏ö‡∏≠‡∏•','‡∏û‡∏ô‡∏±‡∏ô‡∏ö‡∏≠‡∏•','‡∏û‡∏ô‡∏±‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå','‡∏û‡∏ô‡∏±‡∏ô‡∏ö‡∏≤‡∏Ñ‡∏≤‡∏£‡πà‡∏≤','‡∏ö‡∏≤‡∏Ñ‡∏≤‡∏£‡πà‡∏≤'\n  ],\n  time:      ['‡∏´‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ô','‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ô','‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏π‡πà‡∏£‡∏±‡∏Å','‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏ô‡∏£‡∏±‡∏Å','‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å'],\n  mentalhealth: [\n    '‡∏≠‡∏¢‡∏≤‡∏Å‡∏ï‡∏≤‡∏¢','‡∏Ü‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏¢','‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß','‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤','‡∏´‡∏°‡∏î‡∏´‡∏ß‡∏±‡∏á','‡∏≠‡∏¢‡∏≤‡∏Å‡∏´‡∏≤‡∏¢‡πÑ‡∏õ','‡∏à‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï','‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß‡πÅ‡∏•‡πâ‡∏ß',\n    '‡∏à‡∏∞‡∏ó‡∏≥‡∏£‡πâ‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á','‡∏Å‡∏£‡∏µ‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠','‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ï‡∏∂‡∏Å','‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î',\n    '‡∏Ç‡∏∑‡∏ô‡πÉ‡∏à','‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏°‡∏µ‡πÄ‡∏û‡∏®‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏Ç‡πà‡∏°‡∏Ç‡∏∑‡∏ô',\n    '‡∏ñ‡∏π‡∏Å‡∏ó‡∏≥‡∏£‡πâ‡∏≤‡∏¢','‡∏ó‡∏≥‡∏£‡πâ‡∏≤‡∏¢‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢','‡πÇ‡∏î‡∏ô‡∏ï‡∏ö‡∏ï‡∏µ','‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å','‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ä‡πâ‡∏≥',\n    'panic','‡πÅ‡∏û‡∏ô‡∏¥‡∏Å','‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å','‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ï‡πâ‡∏ô‡πÅ‡∏£‡∏á','‡∏°‡∏∑‡∏≠‡∏™‡∏±‡πà‡∏ô',\n    '‡∏â‡∏±‡∏ô‡∏Ñ‡∏ß‡∏£‡∏ï‡∏≤‡∏¢‡πÑ‡∏´‡∏°','‡πÑ‡∏õ‡∏ï‡∏≤‡∏¢‡∏ã‡∏∞'\n  ],\n};\n\n// ============ Compile regex ============\nconst COMPILED = Object.fromEntries(\n  Object.entries(CATEGORIES).map(([k, arr]) => ([\n    k,\n    {\n      raw: new RegExp(arr.map(esc).join('|'), 'i'),\n      ns:  new RegExp(arr.map(w => esc(rmThaiMarks(w).replace(/\\s+/g, ''))).join('|'), 'i'),\n    }\n  ]))\n);\n\n// ============ Pair rules ============\nconst FAMILY_BASE_RX = /(‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà|‡∏û‡πà‡∏≠|‡πÅ‡∏°‡πà|‡∏ç‡∏≤‡∏ï‡∏¥|‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á|‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß|‡∏ö‡πâ‡∏≤‡∏ô)/i;\nconst PARTNER_RX     = /(‡πÅ‡∏ü‡∏ô|‡∏Ñ‡∏π‡πà‡∏£‡∏±‡∏Å|‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™|‡∏™‡∏≤‡∏°‡∏µ|‡∏†‡∏£‡∏£‡∏¢‡∏≤|‡∏ú‡∏±‡∏ß|‡πÄ‡∏°‡∏µ‡∏¢)/i;\n\nconst DEBT_BASE_RX   = /(‡∏´‡∏ô‡∏µ‡πâ|‡∏ï‡∏¥‡∏î‡∏´‡∏ô‡∏µ‡πâ|‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏µ‡πâ|‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô|‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ|‡∏ó‡∏ß‡∏á‡∏´‡∏ô‡∏µ‡πâ|‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡∏µ‡πâ|‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô|‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô|‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô)/i;\nconst GAMBLE_BASE_RX = /(‡∏û‡∏ô‡∏±‡∏ô|‡πÅ‡∏ó‡∏á‡∏ö‡∏≠‡∏•|‡∏û‡∏ô‡∏±‡∏ô‡∏ö‡∏≠‡∏•|‡πÇ‡∏ï‡πä‡∏∞‡∏ö‡∏≠‡∏•|‡∏ö‡∏≤‡∏Ñ‡∏≤‡∏£‡πà‡∏≤|‡∏Ñ‡∏≤‡∏™‡∏¥‡πÇ‡∏ô|‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏ä‡∏Ñ)/i;\n\n// ============ Buddy detector ============\nconst BUDDY_WORDS = ['‡πÄ‡∏´‡πâ‡∏¢','‡∏°‡∏∂‡∏á','‡πÅ‡∏°‡πà‡∏á','‡πÄ‡∏´‡∏µ‡πâ‡∏¢','‡∏™‡∏±‡∏™','‡∏Å‡∏π','‡∏ô‡∏µ‡πà‡πÜ','‡∏ß‡∏∞'];\nconst BUDDY_HEAD_RX = new RegExp(`^(?:${BUDDY_WORDS.map(esc).join('|')})`, 'i');\n\nconst BUDDY_TOKEN_RX = new RegExp(\n  `(^|[^‡∏Å-‡πôa-zA-Z0-9])(?:${BUDDY_WORDS.map(esc).join('|')})(?=$|[^‡∏Å-‡πôa-zA-Z0-9])`,\n  'i'\n);\nconst BUDDY_GLUE_RX = /(‡πÄ‡∏´‡πâ‡∏¢‡∏°‡∏∂‡∏á|‡πÑ‡∏≠‡πÄ‡∏´‡∏µ‡πâ‡∏¢|‡πÅ‡∏°‡πà‡∏á‡πÄ‡∏≠‡πä‡∏¢|‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡πÑ‡∏£)/i;\n\n// ============ Main ============\nconst payload = items[0].json || {};\nconst events = (payload.body && payload.body.events) || [];\nconst out = [];\n\nfor (const ev of events) {\n  const isText = ev?.message?.type === 'text';\n  const msg = isText ? String(ev.message.text || '').trim() : '';\n  const replyToken = ev.replyToken || '';\n  const userId = ev?.source?.userId || '';\n\n  if (!msg) continue;\n\n  const n = normalize(msg);\n\n  // Buddy mode\n  const buddy =\n  BUDDY_HEAD_RX.test(n.raw) ||\n  BUDDY_HEAD_RX.test(n.noMarks) ||\n  BUDDY_TOKEN_RX.test(n.raw) ||\n  BUDDY_TOKEN_RX.test(n.noMarks) ||\n  BUDDY_GLUE_RX.test(n.noSpace);\n\n  // Routes\n  let routes = [];\n  for (const [k, rx] of Object.entries(COMPILED)) {\n    if (rx.raw.test(n.raw) || rx.ns.test(n.noSpace)) routes.push(k);\n  }\n\n  // Pair rules\n  if ((FAMILY_BASE_RX.test(n.raw) || FAMILY_BASE_RX.test(n.noSpace)) &&\n      (PARTNER_RX.test(n.raw) || PARTNER_RX.test(n.noSpace)) &&\n      !routes.includes('family')) {\n    routes.push('family');\n  }\n  if ((DEBT_BASE_RX.test(n.raw) || DEBT_BASE_RX.test(n.noSpace)) &&\n      (GAMBLE_BASE_RX.test(n.raw) || GAMBLE_BASE_RX.test(n.noSpace)) &&\n      !routes.includes('debt')) {\n    routes.push('debt');\n  }\n\n  if (!routes.length) routes = ['default'];\n\n  // Critical flag\n  const isCritical = routes.includes('mentalhealth');\n\n  out.push({\n    json: {\n      chat_text: msg,\n      replyToken,\n      userId,\n      route: routes,\n      isCritical,\n      buddy,\n    },\n  });\n}\n\nreturn out.length ? out : [{ json: { error: 'No text events' } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        96,
        -64
      ],
      "id": "d87f0df1-e537-420a-8863-6aceb007f522",
      "name": "‡∏™‡∏Å‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πà‡∏ß‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏à‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏•‡∏¢ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏•‡∏≥‡∏û‡∏±‡∏á\\n‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÇ‡∏ó‡∏£ 191\\n‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ‡πÇ‡∏ó‡∏£ 1323 (‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï) ‡∏´‡∏£‡∏∑‡∏≠ 1300 (‡∏û‡∏°.) 24 ‡∏ä‡∏°.\\n‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏£‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ü‡∏±‡∏á üíô\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1248,
        -48
      ],
      "id": "6793a4e6-9d01-4f45-9486-0ab24140feb1",
      "name": "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢",
      "credentials": {
        "httpBearerAuth": {
          "id": "wAbVyNGfMeeH6MYu",
          "name": "Bearer Line Auth account"
        }
      }
    },
        {
          "parameters": {
            "promptType": "define",
            "text": "=‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÇ‡∏ó‡∏ô‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô\n‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï: {{ $('‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠').item.json.route_expanded }}\n\n‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏à‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß):\n1) ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° (‚â§2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)\n2) ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Ä¢ ‚â§3 ‡∏Ç‡πâ‡∏≠\n3) ‡∏ó‡∏≥‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‚â§2 ‡∏Ç‡πâ‡∏≠\n\n‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à + {{ $('‡∏™‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢').item.json.closing }}\n\n‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏ß‡∏° ‚â§700 ‡∏≠‡∏±‡∏Å‡∏©‡∏£\n\n‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: {{ $json.chat_text }}",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2,
          "position": [
            2080,
            592
          ],
          "id": "6770a149-8ef5-4a44-bf0a-b8beaf07fc5e",
          "name": "AI ‡∏®‡∏¥‡∏£‡∏≤‡∏ô‡∏µ"
        },
    {
      "parameters": {
        "promptType": "define",
        "text": "=‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏ö‡∏ö‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÇ‡∏ó‡∏ô‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏°‡∏≤\n‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï: {{ $('‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠').item.json.route_expanded }}\n\n‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏à‡∏ö‡πÉ‡∏ô‡∏à‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß):\n1) ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‚â§2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô)\n2) ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Ä¢ ‚â§3 ‡∏Ç‡πâ‡∏≠ (‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á)\n3) ‡∏ó‡∏≥‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‚â§2 ‡∏Ç‡πâ‡∏≠ (‡∏Ç‡πâ‡∏≠‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)\n‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à + {{ $('‡∏™‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢').item.json.closing }}\n‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏ß‡∏° ‚â§700 ‡∏≠‡∏±‡∏Å‡∏©‡∏£\n\n‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: {{ $json.chat_text }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        2064,
        64
      ],
      "id": "c62d6936-b4ab-40e7-a0df-7679688a1d7a",
      "name": "AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏Å"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2080,
        272
      ],
      "id": "c0ce7ef8-759c-41ff-a91b-f8075ac4f515",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "tIHUPdMbXkkTH0y7",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ==== Ending message lists ====\nconst ENDINGS = {\n  buddy: [\n    \"‡∏™‡∏π‡πâ‡πÜ‡∏ô‡∏∞‡∏°‡∏∂‡∏á\",\n    \"‡πÅ‡∏Å‡πÄ‡∏≠‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ô‡πà\",\n    \"‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏¢\",\n    \"‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏°‡∏≤‡∏Å‡πÄ‡∏ß‡πâ‡∏¢ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô\",\n    \"‡∏°‡∏∂‡∏á‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß\",\n    \"‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡πÄ‡∏ß‡πâ‡∏¢\",\n    \"‡∏ñ‡πâ‡∏≤‡∏°‡∏∂‡∏á‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡∏≠‡∏µ‡∏Å ‡∏Å‡∏π‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞\",\n    \"‡∏°‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ\",\n    \"‡∏Å‡∏π‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏°‡∏∂‡∏á‡∏ô‡∏∞\",\n    \"‡∏°‡∏∂‡∏á‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏∂‡∏á‡∏Ñ‡∏¥‡∏î‡∏≠‡∏µ‡∏Å\",\n    \"‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏°‡∏±‡∏ô‡∏Å‡πá‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÄ‡∏≠‡∏á‡πÅ‡∏´‡∏•‡∏∞\",\n  ],\n  sirani: [\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏´‡∏ß‡∏±‡∏á üíô\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏à‡∏ï‡∏≤‡∏°‡∏´‡∏≤\",\n    \"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏á‡∏î‡∏á‡∏≤‡∏°‡∏Ñ‡πà‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏∞‡∏Ñ‡∏∞ üíï\",\n    \"‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏Ñ‡πà‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏ö‡∏£‡∏∑‡πà‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏î‡πÉ‡∏™‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô‡∏Ñ‡πà‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏û‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡πà‡∏∞\",\n  ],\n  sex_sirani: [\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏ö‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞ üíô\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏®\",\n    \"‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡∏¢‡∏∑‡∏î‡∏≠‡∏Å‡∏û‡∏Å‡∏ñ‡∏∏‡∏á\",\n  ],\n  sex_buddy: [\n    \"‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡πâ‡∏ü‡∏¥‡∏ô‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡∏°‡∏∂‡∏á\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏ô‡∏∏‡∏Å‡∏ö‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ô‡∏∞‡πÄ‡∏ß‡πâ‡∏¢\",\n    \"‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏û‡∏Å‡∏ñ‡∏∏‡∏á‡∏ô‡∏∞‡∏°‡∏∂‡∏á ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô\",\n  ],\n  family_sirani: [\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏î‡∏µ‡∏ô‡∏∞‡∏Ñ‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏∞\",\n    \"‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏∞\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏ü‡∏±‡∏á‡∏Å‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏∞\",\n  ],\n  family_buddy: [\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏∂‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ô‡∏∞‡πÄ‡∏ß‡πâ‡∏¢\",\n    \"‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏°‡∏∂‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏∞‡∏°‡∏∂‡∏á\",\n    \"‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏∂‡∏á‡πÄ‡∏à‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏ü‡∏±‡∏á‡∏Å‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡∏ô‡∏∞‡πÄ‡∏ß‡πâ‡∏¢\",\n  ],\n};\n\n// ==== Helpers ====\nfunction pickRandom(arr) {\n  return arr[Math.floor(Math.random() * arr.length)];\n}\n\nconst buddy = $json.buddy || false;\nconst routes = $json.route || [];\n\n// ==== ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å closing ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ====\nlet closing = \"\";\n\nif (routes.includes(\"sex\")) {\n  closing = buddy ? pickRandom(ENDINGS.sex_buddy) : pickRandom(ENDINGS.sex_sirani);\n} else if (routes.includes(\"family\")) {\n  closing = buddy ? pickRandom(ENDINGS.family_buddy) : pickRandom(ENDINGS.family_sirani);\n} else {\n  closing = buddy ? pickRandom(ENDINGS.buddy) : pickRandom(ENDINGS.sirani);\n}\n\nreturn [{\n  json: {\n    ...$json,\n    closing\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        240
      ],
      "id": "da91dbf1-0113-4257-b417-27ee191f367d",
      "name": "‡∏™‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢"
    },
    {
      "parameters": {
        "jsCode": "//‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏•‡∏∂‡∏Å‡∏ã‡∏∂‡πâ‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\nconst DEEP_TALK = {\n  early: [\n    \"‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏¥‡πâ‡∏°‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô?\",\n    \"‡∏ß‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ù‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå?\",\n    \"‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?\"\n  ],\n  building: [\n    \"‡∏≠‡∏µ‡∏Å 3‚Äì5 ‡∏õ‡∏µ ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?\",\n    \"‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡∏ç‡πà ‡πÜ ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏á?\",\n    \"‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡πâ‡∏≠‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏î‡∏µ?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ó‡πà‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏á‡∏≤‡∏ô/‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô?\",\n    \"‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå?\"\n  ],\n  married: [\n    \"‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≠‡∏á‡∏†‡∏≤‡∏û ‚Äú‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏ù‡∏±‡∏ô‚Äù ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏™‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡∏•‡∏π‡∏Å‡πÑ‡∏´‡∏°? ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ï‡πà‡∏≤‡∏á?\"\n  ],\n  intimacy: [\n    \"‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏±‡∏ô?\",\n    \"‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏° (‡πÇ‡∏î‡∏¢‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà)?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?\",\n    \"‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô?\",\n    \"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?\"\n  ]\n};\n\n// === Helpers ===\nfunction pickRandom(arr, n = 3) {\n  const shuffled = [...arr].sort(() => 0.5 - Math.random());\n  return shuffled.slice(0, n);\n}\n\n// === Regex Map ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏•‡∏±‡∏Å ===\nconst TOPIC_MAP = {\n  early: /(‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏µ‡∏ö|‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏Ñ‡∏∏‡∏¢|‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å|‡∏Ñ‡∏∏‡∏¢‡∏°‡∏≤‡πÑ‡∏°‡πà‡∏ô‡∏≤‡∏ô)/i,\n  building: /(‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß|‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï|‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô|‡πÅ‡∏ú‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï|3-5‡∏õ‡∏µ|3‚Äì5‡∏õ‡∏µ)/i,\n  married: /(‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô|‡∏ö‡πâ‡∏≤‡∏ô|‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß|‡∏Ñ‡∏π‡πà‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï|‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô)/i,\n  intimacy: /(‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á|‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î|‡∏Å‡∏≠‡∏î|‡∏à‡∏π‡∏ö|‡πÄ‡∏û‡∏®|intimacy|sex)/i\n};\n\n// === Input ===\nconst msg = $json.chat_text || \"\";\n\n// === Detect ‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà ===\nlet selected = \"early\"; // default\nfor (const [topic, rx] of Object.entries(TOPIC_MAP)) {\n  if (rx.test(msg)) {\n    selected = topic;\n    break;\n  }\n}\n\n// === ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠ ===\nconst questions = DEEP_TALK[selected] || [];\nconst randomQuestions = pickRandom(questions, 1); // ‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏° 1 ‡∏Ç‡πâ‡∏≠\n\nreturn [{\n  json: {\n    ...$json,\n    deeptalk_topic: selected,\n    deeptalk_questions: randomQuestions\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        544,
        -192
      ],
      "id": "bd805d20-313b-483b-af62-829194fde0f8",
      "name": "‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° deeptalk"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.deeptalk_questions[0] }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        816,
        -208
      ],
      "id": "1c60e749-beb2-4256-ab11-eb9bb8640bd9",
      "name": "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° deeptalk",
      "credentials": {
        "httpBearerAuth": {
          "id": "wAbVyNGfMeeH6MYu",
          "name": "Bearer Line Auth account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6d35680b-5fa1-4b6c-8078-caf79e7cbc9c",
              "leftValue": "={{ $json.buddy }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1728,
        176
      ],
      "id": "a622d04e-8667-47b5-ab5b-16c077cddc94",
      "name": "‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏á AI"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "11facf21-1726-4188-b2d9-b1c9e7f75813",
              "leftValue": "={{ $json.isCritical }}",
              "rightValue": "=s true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        768,
        240
      ],
      "id": "f4a052aa-1961-4fa3-a22c-c9e3c714ffe0",
      "name": "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.route[0] }}",
                    "rightValue": "deeptalk",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7cc0e3ff-4bce-4551-824b-527b87e9df71"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "deeptalk"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cee60e14-55c3-4955-96a0-194f04b53e3c",
                    "leftValue": "={{ $json.route[0] }}",
                    "rightValue": "sex",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Sex"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "ignoreCase": false,
          "allMatchingOutputs": false
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        256,
        -336
      ],
      "id": "7e61af89-e5b5-48f8-8107-93c3eb741562",
      "name": "Switch"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        768,
        -384
      ],
      "id": "f3b53ed2-4587-45f8-add0-eb855470fc0e",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "tIHUPdMbXkkTH0y7",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏® ‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÇ‡∏ó‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û\n‡πÄ‡∏ô‡πâ‡∏ô: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏®‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏° ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ\n‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: {{ $('‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠').item.json.route_expanded }}\n\n‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏à‡∏ö‡πÉ‡∏ô‡∏à‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß):\n1) ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‚â§2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î\n2) ‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‚â§3 ‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏ä‡∏¥‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ)\n3) ‡∏ó‡∏≥‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‚â§2 ‡∏Ç‡πâ‡∏≠ (‡∏Ç‡πâ‡∏≠‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)\n‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à 1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î\n‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏ß‡∏° ‚â§700 ‡∏≠‡∏±‡∏Å‡∏©‡∏£\n\n‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: {{ $json.chat_text }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        752,
        -640
      ],
      "id": "c777a9f3-3d04-45ac-ad32-934ed89dd0fd",
      "name": "AI ‡πÄ‡∏û‡∏®‡∏®‡∏∂‡∏Å‡∏©‡∏≤"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $('‡∏™‡∏Å‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠').item.json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": {{ JSON.stringify((($json.output ?? '').toString()).slice(0,4800)) }}\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1856,
        -640
      ],
      "id": "3b16fbcf-bf7f-43b0-b739-caf5ea4fa0f6",
      "name": "HTTP Request1",
      "credentials": {
        "httpBearerAuth": {
          "id": "wAbVyNGfMeeH6MYu",
          "name": "Bearer Line Auth account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "‡∏™‡∏Å‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏á AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI ‡∏®‡∏¥‡∏£‡∏≤‡∏ô‡∏µ",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI ‡∏®‡∏¥‡∏£‡∏≤‡∏ô‡∏µ",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠": {
      "main": [
        [
          {
            "node": "‡∏™‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‡∏™‡∏Å‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI ‡∏®‡∏¥‡∏£‡∏≤‡∏ô‡∏µ": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏Å",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏Å": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‡∏™‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° deeptalk": {
      "main": [
        [
          {
            "node": "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° deeptalk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏á AI": {
      "main": [
        [
          {
            "node": "AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏Å",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI ‡∏®‡∏¥‡∏£‡∏≤‡∏ô‡∏µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á": {
      "main": [
        [
          {
            "node": "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° deeptalk",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI ‡πÄ‡∏û‡∏®‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI ‡πÄ‡∏û‡∏®‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI ‡πÄ‡∏û‡∏®‡∏®‡∏∂‡∏Å‡∏©‡∏≤": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "6832bae8-c5c3-4f79-8e44-e2152a89b93d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "6476a8f9274121855a8c7dab84a1aaa60aa02de3b1ea9e0ff2e84cba5491a19d"
  },
  "id": "EgK1S1DH51UiyDYs",
  "tags": []
}